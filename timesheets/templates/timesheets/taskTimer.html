{% extends 'main/base.html' %}

{% block content %}

<h1>Welcome to the your Task Timer</h1>

  <table class=" table table-hover">
    <tbody>
      <tr>
        <form method="POST" class="container">
        {% csrf_token %}
          <th scope="col">New Task</th>
          {% for row in taskTimerForm %}
          <td scope="col">
            {{ row }}
          </td>   
        {% endfor %}
          <td>
              <button type="submit" formmethod="POST" formaction="{% url 'Create_Timer' %}" class="btn btn-m btn-primary">Add</button>
          </td>
        </form>
      </tr>
    </tbody>
  </table>

<h3>Task History</h3>
<table class="table table-hover ">
  <thead>
    <tr>
      <th scope="col">Daily Tasks</th>
      <th  scope="col">Job Code</th>
      <th scope="col">Description</th>
      <th scope="col">Time Spent</th>
      <th scope="col"></th>
    </tr>
  </thead>
  <tbody>
  {% for task in userTasks %}
    <tr>
      <th scope="col">
        {{ task.id }}
      </th>
      <td scope="col ">
        {{ task.job_code }}
      </td>
      <td scope="col">
        {{ task.description }}
      </td>
      <td scope="col">
        {{ task.elapsed_time }}
      </td>
      <td class="col-2" scope="col">
        <div class=" container btn-group" role="group" aria-label="Basic mixed styles example">
          {% if task.is_running == True %}
          <button type="button" class="btn btn-success"> Pause </button>
          {% else %} 
          <button type="button" class="btn btn-success"> Start </button>
          {% endif %}
          <button type="button" class="btn btn-warning">Edit</button>
          <button type="button" class="btn btn-danger">Delete</button>
        </div>
      </td>
    </tr> 
  {% empty %}
    <tr>
      <td colspan="12" >You have no task history</td class="col-12">
    </tr>
    {% endfor %}
  </tbody>
</table>


<script>
  console.log("This is Tim's script")
  const startBtn = document.getElementById("timerButton")
  let seconds = 0
  let isTiming = false
  let timer

  function getAccumalatedTime(){
    let inputTime = document.getElementById("elapsed_time_input").value
    let parts = inputTime.split(":")
    seconds += ((+parts[0]*60*60)+(+parts[1]*60)+(+parts[2]))
  }

  function incrementTimer(){
    seconds++
    let date = new Date(null)
    date.setSeconds(seconds)
    let timeStr = date.toISOString().substr(11,8)
    let inputTime = document.getElementById('elapsed_time_input').value = timeStr
  }

  startBtn.addEventListener("click", ()=>{
    if (isTiming) {
      // Pause timer
      isTiming = false
      startBtn.textContent = "Start"
      clearInterval(timer)
    } else {
      // Start Timer
      isTiming = true
      seconds = 0
      getAccumalatedTime()
      startBtn.textContent = "Pause"
      timer = setInterval(incrementTimer, 1000)
    }
  })

</script>

{% endblock content %}
